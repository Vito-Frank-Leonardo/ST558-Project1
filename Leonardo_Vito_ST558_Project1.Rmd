---
title: "Project1"
author: "Vito Frank Leonardo"
date: "6/14/2021"
output: 
  html_document:
    toc: yes
    toc_float: no
    toc_depth: 3
---
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Packages Needed:
```{r}
library(tidyverse)
library(httr)
library(jsonlite)
library(gtools)
```


You should write functions to contact the NHL records API for the endpoints listed below. The
functions should return well-formatted, parsed data (usually a data frame). Where possible, the user should have the option to specify the franchise of choice by both name and ID number - youâ€™ll need to map the names to ID numbers yourself

```{r BaseURL}
Base_URL <- "https://records.nhl.com/site/api"
```

```{r returnFunction}

returnFunction <- function(ID=NULL, Name=NULL){
  
}
```

```{r Franchise}
FranchiseInfo <- function(ID=NULL, Name=NULL){
  franchise <- "/franchise"
  req <- GET(paste0(Base_URL,franchise)) # from httr library
  data <- content(req) # from httr library

  df <- data.frame(matrix(rep(0,8), nrow=1))
  colnames(df) <- names(data$data[[2]])
  for( i in 1:length(data$data)){
    datalist <- data$data[[i]]
    temp <- data.frame(matrix(datalist, nrow=1))
    df[i,] <- temp
  }

  if(is.null(ID) & is.null(Name)){
    return(df)
  } else{
      NamesDf <- df %>% 
       select(id, teamCommonName) %>%
       filter(teamCommonName %in% Name)
      ID <- unique(union(ID,unlist(NamesDf$id )))
  
    return(df %>% filter(id %in% ID))
  }
}
```  


```{r teamTotals}

TeamTotals <- function(ID=NULL, Name=NULL){

  NamesDf <- FranchiseInfo(ID,Name) %>% 
    select(id, fullName, teamCommonName, teamPlaceName, teamAbbrev) %>%
    rename(franchiseId = id)
  
  teamTotals <- "/franchise-team-totals"
  req <- GET(paste0(Base_URL,teamTotals)) # from httr library
  data <- (content(req)) # from httr library

  df <- data.frame(matrix(rep(0,length(data$data[[1]])), nrow=1))
  colnames(df) <- names(data$data[[2]])
  for( i in 1:length(data$data)){
    datalist <- data$data[[i]]
    temp <- data.frame(matrix(datalist, nrow=1))
    df[i,] <- temp
  }
  
  df <- df %>% left_join(NamesDf,"franchiseId")
  
  if(is.null(ID) & is.null(Name)){
    return(df)
  } else{
      NamesDf <- df %>% 
       select(id, teamCommonName) %>%
       filter(teamCommonName %in% Name)
      ID <- unique(union(ID,unlist(NamesDf$id )))
  
    return(df %>% filter(id %in% ID))
  }
}

  
```
 
```{r}
AssistingFun <- function(Type,ID){

  Records <- paste0("/franchise-",Type,"-records?cayenneExp=franchiseId=",ID[1])
  req <- GET(paste0(Base_URL,Records)) # from httr library
  data <- content(req) # from httr library
  df <- data.frame(matrix(data$data[[1]],nrow = 1))
  colnames(df) <- names(data$data[[1]])
  
  if(length(ID)!=1){
    for(i in 2:length(ID)){
    Records <- paste0("/franchise-",Type,"-records?cayenneExp=franchiseId=",ID[i])
    req <- GET(paste0(Base_URL,Records)) # from httr library
    data <- content(req) # from httr library
    temp <- data.frame(matrix(data$data[[1]],nrow = 1))
    colnames(temp) <- names(df)
    df <- rbind(df,temp)
    }
  }

  return(df)
}  

``` 
 
```{r Season}

SeasonRecords <- function(ID =NULL, Name = NULL){

  NamesDf <- FranchiseInfo(ID,Name) 
  ID <- unlist(NamesDf$id )
  Type = "season"

  AssistingFun(Type,ID)
}
```



```{r}

GoalieRecords <- function(ID =NULL, Name = NULL){
  
  NamesDf <- FranchiseInfo(ID,Name) 
  ID <- unlist(NamesDf$id )
  ID <- ID[!ID == 39]
  Type <- "goalie"
  
  AssistingFun(Type,ID)
}
```

```{r}

SkaterRecords <- function(ID =NULL, Name = NULL){

  NamesDf <- FranchiseInfo(ID,Name) 
  ID <- unlist(NamesDf$id )
  ID <- ID[!ID == 39]
  Type = "skater"

  Records <- paste0("/franchise-",Type,"-records?cayenneExp=franchiseId=",ID[1])
  req <- GET(paste0(Base_URL,Records)) # from httr library
  data <- content(req) # from httr library
  df <- data.frame(matrix(data$data[[1]],nrow = 1))
  colnames(df) <- names(data$data[[1]])
  for(j in 2:length(data$data)){
    temp <- data.frame(matrix(data$data[[j]],nrow = 1))
    colnames(temp) <- colnames(df)
    df <- rbind(df,temp)
  }
  if(length(ID)!= 1){
    for(i in 2:length(ID)){
    Records <- paste0("/franchise-",Type,"-records?cayenneExp=franchiseId=",ID[i])
    req <- GET(paste0(Base_URL,Records)) # from httr library
    data <- content(req) # from httr library
      for(j in 1:length(data$data)){
      temp <- data.frame(matrix(data$data[[j]],nrow = 1))
      colnames(temp) <- colnames(df)
      df <- rbind(df,temp)
      }
    }
  }

  return(df)

}
```



```{r}

AdminRecords <- function(ID =NULL, Name = NULL){
  
  NamesDf <- FranchiseInfo(ID,Name) 
  ID <- unlist(NamesDf$id )
  ID <- ID[!ID == 39]
  df<-NULL
  
  Records <- paste0("/franchise-detail?cayenneExp=mostRecentTeamId=",ID[1])
  req <- GET(paste0(Base_URL,Records)) # from httr library
  data <- content(req) # from httr library
  if(!is.null(unlist(data$data))){
    df <- data.frame(matrix(data$data[[1]],nrow = 1))
    colnames(df) <- names(data$data[[1]])
  }
  
  if(length(ID)!=1){
    for(i in 2:length(ID)){
    Records <- paste0("/franchise-detail?cayenneExp=mostRecentTeamId=",ID[i])
    req <- GET(paste0(Base_URL,Records)) # from httr library
    data <- content(req) # from httr library
      if(!is.null(unlist(data$data))){
        temp <- data.frame(matrix(data$data[[1]],nrow = 1))
        colnames(temp) <- names(df)
        df <- rbind(df,temp) 
      }
    }
  }
  if(is.null(df)){
    stop("There is no data for the ID specified")
  }
  return(df)
}

```

```{r}

StatsExpandMod <- function(ID=NULL,Name=NULL){
  Base_URL_Stats <- "https://statsapi.web.nhl.com/api/v1/teams/"
  Modifier <- "?expand=team.stats"
  
  NamesDf <- FranchiseInfo(ID,Name) 
  ID <- unlist(NamesDf$id )
  ID <- ID[!ID == 39]
  df<-NULL
  
  
  req <- GET(paste0(Base_URL_Stats,ID[1],Modifier)) # from httr library
  data <- content(req) # from httr library
  df <- data.frame(data$teams[[1]])
  if(length(ID != 1)){
    for(i in 2:length(ID)){
      req <- GET(paste0(Base_URL_Stats,ID[i],Modifier)) # from httr library
      data <- content(req) # from httr library
      temp <- data.frame(data$teams[[1]])
      df <- smartbind(df,temp)
    }    
  }

  return(df)
}

```


```{r Wrapper}
Wrapper <- function(fun,ID=NULL,Name=NULL){
  switch(fun,
             Info = FranchiseInfo(ID,Name),
             Totals = TeamTotals(ID,Name),
             Goalie = GoalieRecords(ID,Name), 
             Season = SeasonRecords(ID,Name), 
             Skater = SkaterRecords(ID,Name), 
             Admin= AdminRecords(ID,Name), 
             TeamStat = StatsExpandMod(ID,Name),
             stop("fun must be one of the following: Info, Totals, Goalie, Season, Skater, Admin or TeamStat. fun must also be in quotation marks"))
  
}
```




